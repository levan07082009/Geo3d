<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cart - Geo3D</title>
<style>
.contact-container { background-color: var(--surface-color); padding: 20px; margin-top: 50px; text-align: center; border-radius: var(--border-radius); box-shadow: var(--shadow); }
.contact-container p { margin: 5px 0; }
.contact-container a { color: var(--primary-color); text-decoration: none; font-weight: 500; }
.contact-container a:hover { text-decoration: underline; }

:root {
  --primary-color: #3498db;
  --secondary-color: #2c3e50;
  --background-color: #ecf0f1;
  --surface-color: #ffffff;
  --text-color: #34495e;
  --border-radius: 8px;
  --shadow: 0 4px 15px rgba(0,0,0,0.1);
}
body {
  font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue',sans-serif;
  margin:0;
  background-color: var(--background-color);
  color: var(--text-color);
}
.container { width:90%; max-width:1200px; margin:0 auto; padding:20px 0; }
h2 { text-align:center; color: var(--secondary-color); margin-bottom:30px; }

/* Header */
header {
  background-color: var(--surface-color);
  padding: 15px 5%;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow: var(--shadow);
  position: sticky;
  top:0;
  z-index:1000;
}
.logo { font-size:1.5em; font-weight:bold; color: var(--primary-color); text-decoration:none; }
nav a { text-decoration:none; color: var(--secondary-color); margin-left:20px; font-weight:500; transition:color 0.3s; }
nav a:hover { color: var(--primary-color); }
.cart-indicator { position:relative; cursor:pointer; }
.cart-count { position:absolute; top:-10px; right:-15px; background-color: var(--primary-color); color:white; border-radius:50%; padding:2px 6px; font-size:0.8em; font-weight:bold; }

/* Cart */
.cart-container { background-color: var(--surface-color); padding:30px; border-radius: var(--border-radius); box-shadow: var(--shadow); margin-top:40px; }
.cart-item { display:flex; align-items:center; border-bottom:1px solid #ddd; padding:20px 0; flex-wrap:wrap; }
.cart-item:last-child { border-bottom:none; }
.cart-item-image { width:100px; height:100px; object-fit:cover; border-radius: var(--border-radius); margin-right:20px; }
.cart-item-details { flex:1; min-width:200px; }
.cart-item-name { font-size:1.2em; font-weight:600; margin:0 0 5px; }
.cart-item-variant { font-size:0.9em; color:#777; margin-bottom:5px; }
.cart-item-price { color:#777; margin-bottom:5px; }
.quantity-selector { display:flex; align-items:center; margin:0 20px; }
.quantity-btn { background-color:#eee; border:1px solid #ccc; color:var(--text-color); cursor:pointer; width:30px; height:30px; font-size:1.2em; border-radius:50%; }
.quantity-display { padding:0 15px; font-size:1.1em; font-weight:bold; }
.item-total-price { font-size:1.2em; font-weight:bold; width:100px; text-align:right; }
#empty-cart-message { text-align:center; padding:50px; font-size:1.2em; }
.cart-total-container { text-align:right; margin-top:30px; font-size:1.5em; font-weight:bold; }
.total-label { color: var(--secondary-color); }
#cart-total-price { color: var(--primary-color); margin-left:15px; }
.checkout-btn { display:inline-block; margin-top:20px; padding:12px 25px; background-color: var(--primary-color); color:white; border:none; border-radius:25px; font-size:1em; cursor:pointer; transition: background 0.3s; }
.checkout-btn:hover { background-color:#2980b9; }

/* Modal */
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:2000; }
.modal-content { background:var(--surface-color); padding:30px; border-radius: var(--border-radius); width:90%; max-width:500px; box-shadow: var(--shadow); }
.modal-content h3 { margin-top:0; color: var(--secondary-color); }
.modal-content input, .modal-content textarea { width:100%; margin:10px 0; padding:10px; border-radius: var(--border-radius); border:1px solid #ccc; font-size:1em; }
.modal-content textarea { resize:vertical; min-height:80px; }
.modal-buttons { text-align:right; margin-top:15px; }
.close-btn { background:#ccc; margin-right:10px; }
.place-btn { background: var(--primary-color); color:white; }
.close-btn, .place-btn { padding:10px 20px; border:none; border-radius:20px; cursor:pointer; }
.close-btn:hover { background:#bbb; }
.place-btn:hover { background:#2980b9; }

/* Search & Trending */
.search-container { text-align:center; margin:40px 0; }
#search-bar { width:50%; max-width:500px; padding:12px 20px; font-size:1em; border-radius:25px; border:1px solid #ddd; }
.trending-section { margin-top:60px; }
.trending-slider { display:flex; overflow-x:auto; padding-bottom:20px; }
.product-card { background-color: var(--surface-color); border-radius: var(--border-radius); overflow:hidden; box-shadow: var(--shadow); transition: transform 0.3s; }
.product-card:hover { transform: translateY(-5px); }
.product-card a { text-decoration:none; color:inherit; }
.product-card img { width:100%; height:200px; object-fit:cover; }
.product-info { padding:15px; }
.product-name { font-size:1.1em; font-weight:600; margin:0 0 10px 0; }
.product-price { font-size:1.2em; font-weight:bold; color: var(--primary-color); }
.trending-slider .product-card { flex:0 0 280px; margin-right:20px; }
</style>
</head>
<body>

  <header>
    <a href="index.html" class="logo">
        <img src="product_images/logo.png" alt="Geo3D Logo" style="height:40px; vertical-align:middle;">
        Geo3D
    </a>
    <nav>
        <a href="about-us.html">·Éï·Éò·Éú ·Éï·Éê·É†·Éó ·É©·Éï·Éî·Éú?</a>
        <a href="cart.html" class="cart-indicator">üõí Cart<span class="cart-count">0</span></a>
    </nav>
</header>

<div class="container">
  <h2>Your Shopping Cart</h2>
  <div class="cart-container" id="cart-container"></div>
  <div class="cart-total-container">
    <span class="total-label">Total:</span>
    <span id="cart-total-price">‚Çæ0.00</span>
  </div>
  <button class="checkout-btn" id="checkout-btn">Proceed to Checkout</button>
</div>

<!-- Checkout Modal -->
<div class="modal" id="checkout-modal">
  <div class="modal-content">
    <h3>Checkout Information</h3>
    <input type="text" id="cust-name" placeholder="Full Name" required>
    <input type="email" id="cust-email" placeholder="Email Address" required>
    <input type="text" id="cust-phone" placeholder="Phone Number" required>
    <textarea id="cust-address" placeholder="Shipping Address" required></textarea>
    <textarea id="cust-notes" placeholder="Additional Notes (optional)"></textarea>
    <div class="modal-buttons">
      <button class="close-btn" type="button" id="close-modal">Cancel</button>
      <button class="place-btn" type="button" id="place-order">Place Order</button>
    </div>
  </div>
</div>

<div class="container">
  <div class="search-container">
    <input type="text" id="search-bar" placeholder="Search for other products...">
  </div>
  <div class="trending-section">
    <h2>You Might Also Like</h2>
    <div class="trending-slider" id="trending-slider"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
emailjs.init("VehlCLaDVie4uTU6R");
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  let allProducts = [];

  function getCart() { return JSON.parse(localStorage.getItem('shoppingCart')) || {}; }
  function saveCart(cart){ localStorage.setItem('shoppingCart', JSON.stringify(cart)); updateCartIndicator(); renderCart(); }
  function updateCartIndicator(){ 
    const cart = getCart(); 
    const totalItems = Object.values(cart).reduce((s,q)=>s+q,0); 
    document.querySelector('.cart-count').textContent = totalItems;
  }
  function changeQuantity(productKey, delta){
    const cart = getCart();
    if(cart[productKey]){
      cart[productKey] += delta;
      if(cart[productKey]<=0) delete cart[productKey];
      saveCart(cart);
    }
  }

  fetch('products.json').then(r=>r.json()).then(data=>{
    allProducts = data;
    renderCart();
    renderTrendingSlider(allProducts.filter(p=>p.trending));
  });

  function getVariantPrice(product, variantName){
    if(!variantName) return 0;
    const variant = product.variants.find(v=>v.name === variantName);
    return variant ? variant.priceadded : 0;
  }

  function renderCart(){
    const cart = getCart();
    const container = document.getElementById('cart-container');
    container.innerHTML = '';
    let total = 0;
    const keys = Object.keys(cart);
    if(keys.length===0){
      container.innerHTML = '<p id="empty-cart-message">Your cart is empty.</p>';
      document.getElementById('cart-total-price').textContent='‚Çæ0.00';
      return;
    }

    keys.forEach(key=>{
      const parts = key.split('_'); // format: id_variant
      const id = parseInt(parts[0]);
      const variantName = parts[1] || null;
      const product = allProducts.find(p=>p.id===id);
      if(!product) return;
      const addedPrice = getVariantPrice(product, variantName);
      const finalPrice = product.price + addedPrice;
      const qty = cart[key];
      const subtotal = finalPrice*qty;
      total+=subtotal;
      const item = document.createElement('div');
      item.className='cart-item';
      item.innerHTML=`
        <img src="${product.image}" alt="${product.name}" class="cart-item-image">
        <div class="cart-item-details">
          <p class="cart-item-name">${product.name}</p>
          ${variantName?`<p class="cart-item-variant">${variantName}</p>`:''}
          <p class="cart-item-price">‚Çæ${finalPrice.toFixed(2)} each</p>
        </div>
        <div class="quantity-selector">
          <button class="quantity-btn decrease-btn" data-key="${key}">-</button>
          <span class="quantity-display">${qty}</span>
          <button class="quantity-btn increase-btn" data-key="${key}">+</button>
        </div>
        <span class="item-total-price">‚Çæ${subtotal.toFixed(2)}</span>
      `;
      container.appendChild(item);
    });
    document.getElementById('cart-total-price').textContent=`‚Çæ${total.toFixed(2)}`;
    document.querySelectorAll('.decrease-btn').forEach(btn=>btn.addEventListener('click',e=>changeQuantity(e.target.dataset.key,-1)));
    document.querySelectorAll('.increase-btn').forEach(btn=>btn.addEventListener('click',e=>changeQuantity(e.target.dataset.key,1)));
  }

  function renderTrendingSlider(products){
    const slider=document.getElementById('trending-slider');
    slider.innerHTML='';
    products.forEach(p=>{
      const card=document.createElement('div');
      card.className='product-card';
      card.innerHTML=`
        <a href="product.html?id=${p.id}">
          <img src="${p.image}" alt="${p.name}">
          <div class="product-info">
            <h3 class="product-name">${p.name}</h3>
            <p class="product-price">‚Çæ${p.price.toFixed(2)}</p>
          </div>
        </a>
      `;
      slider.appendChild(card);
    });
  }

  const modal=document.getElementById('checkout-modal');
  document.getElementById('checkout-btn').addEventListener('click',()=>{ modal.style.display='flex'; });
  document.getElementById('close-modal').addEventListener('click',()=>{ modal.style.display='none'; });

  function generateOrderID() {
    const now = Date.now().toString(36);
    const random = Math.floor(Math.random()*1e6).toString(36);
    return `ORD-${now}-${random}`.toUpperCase();
  }

  document.getElementById('place-order').addEventListener('click',()=>{
    const name=document.getElementById('cust-name').value.trim();
    const email=document.getElementById('cust-email').value.trim();
    const phone=document.getElementById('cust-phone').value.trim();
    const address=document.getElementById('cust-address').value.trim();
    const notes=document.getElementById('cust-notes').value.trim();
    if(!name||!email||!phone||!address){ alert('Please fill all required fields.'); return; }

    const cart=getCart();
    if(Object.keys(cart).length===0){ alert('Cart is empty.'); return; }

    const orderID = generateOrderID();
    let totalPrice=0;
    let orderDetails=`<h3>Order ID: ${orderID}</h3><table style="width:100%;border-collapse:collapse;">
      <tr style="background-color:#3498db;color:#fff;">
        <th>Product Image</th>
        <th>Product Name</th>
        <th>Variant</th>
        <th>Qty</th>
        <th>Price</th>
        <th>Subtotal</th>
      </tr>`;
    Object.keys(cart).forEach(key=>{
      const parts=key.split('_');
      const id=parseInt(parts[0]);
      const variantName=parts[1]||'';
      const product=allProducts.find(p=>p.id===id);
      if(product){
        const addedPrice=getVariantPrice(product,variantName);
        const finalPrice=product.price+addedPrice;
        const qty=cart[key];
        const subtotal=finalPrice*qty;
        totalPrice+=subtotal;

        orderDetails+=`
<tr>
  <td><img src="${"https://raw.githubusercontent.com/levan07082009/Geo3d/refs/heads/main"}/${product.image}?raw=true" style="width:100px;height:100px;object-fit:cover;border-radius:4px;"></td>
  <td>${product.name}</td>
  <td>${variantName}</td>
  <td>${qty}</td>
  <td>‚Çæ${finalPrice.toFixed(2)}</td>
  <td>‚Çæ${subtotal.toFixed(2)}</td>
</tr>`;
      }
    });
    orderDetails+=`</table>`;

    emailjs.send("service_a85fm6h","template_lqsqe28",{
      order_id: orderID,
      customer_name:name,
      customer_email:email,
      customer_phone:phone,
      customer_address:address,
      customer_notes:notes||'None',
      order_details:orderDetails,
      total_price:`‚Çæ${totalPrice.toFixed(2)}`
    }).then(()=>{
      alert(`‚úÖ Order placed! Your Order ID: ${orderID}`);
      localStorage.removeItem('shoppingCart');
      modal.style.display='none';
      renderCart();
      updateCartIndicator();
    },err=>{
      alert("‚ùå Failed to send order. Try again.");
      console.error(err);
    });
  });

  document.getElementById('search-bar').addEventListener('keypress', e => {
    if (e.key === 'Enter') {
        const term = e.target.value.toLowerCase();
        window.location.href = "index.html?search=" + encodeURIComponent(term);
    }
});

  updateCartIndicator();
});
</script>

</body>
<div class="contact-container">
  <p>Email: <a href="mailto:geo3d.ge.store@gmail.com">geo3d.ge.store@gmail.com</a></p>
  <p>Phone: <a href="tel:+1234567890">+1 234 567 890</a></p>
  <p>&copy; 2025 Geo3D. All rights reserved.</p>
</div>
</html>
